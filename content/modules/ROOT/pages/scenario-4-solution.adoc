= üí° Scenario #4: Solutions and Resolution

This page provides the detailed solutions for the issues presented in Scenario #4. Review these steps after you have attempted the diagnosis and resolution yourself.

---

## üõë Problem 1: Database Pod Scheduling Failure

### Diagnosis

The **PostgreSQL Database** pods were unable to be scheduled because they had an invalid `nodeSelector` assigned in the CR.  The scheduler could not find any node matching the criteria.

### üõ†Ô∏è Resolution: Correcting Node Scheduling

The fix involves modifying the database configuration within the main **Ansible Automation Platform Custom Resource (CR)**.

#### 1. Modify the Database Configuration in the CR

You have two valid options:

* **Option A: Specify a Valid Selector**
    Replace the existing, incorrect `nodeSelector` with a valid label:

    [source,yaml]
    ----
    spec:
      database:
        ...
        nodeSelector:
          kubernetes.io/os: linux
        ...
    ----

* **Option B: Remove the Selector**
    Delete the `nodeSelector` field entirely from the database section of the CR to allow scheduling on any node.

---

## üõë Problem 2: API Pod Resource Exhaustion

### Diagnosis

The **API** pods were failing due to oversized resource requests and limits defined in the CR. The requests exceeded the available node or cluster resources, preventing pod startup.

### üõ†Ô∏è Resolution: Reducing Resource Requirements

The fix is to reduce the resource requirements defined in the API section of the CR to values that are manageable and realistic. 

#### 1. Modify the API Resource Requirements in the CR

Reduce the values in `spec.automationhub.web.resource_requirements` (or the equivalent API section).

[.instruction]
====
Reduce the resource requests and limits.
====

[source,yaml]
----
# Example snippet of the modified AAP CR
spec:
  automationhub:
    web:
      ...
      resource_requirements:
        requests:
          cpu: 1000m
          memory: 500Mi
        limits:
          cpu: 2000m
          memory: 5Gi
      ...
----

---

## ‚ôªÔ∏è Final Reconciliation

After both CR modifications are applied, the Operator must reconcile the environment.

#### 1. Delete the Gateway Operator Manager Pod

Manually delete the manager pod for the **Gateway Operator** to force it to reconcile the entire platform against the newly updated CR.

[source,bash]
----
oc delete pod -n aap-rh1 <gateway-operator-manager-pod-name>
----

#### 2. Verification

Monitor the namespace until the Database and API pods are successfully redeployed and running.