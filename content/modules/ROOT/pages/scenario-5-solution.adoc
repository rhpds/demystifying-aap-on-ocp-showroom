= üí° Scenario #5: Solutions and Resolution

This page provides the detailed solutions for the issues presented in Scenario #5, specifically resource and storage constraints during Automation Hub synchronization.

---

## üõë Problem 1: Insufficient Resource Limits for Content Pods

### Diagnosis

The **Automation Hub Content** worker pods were being terminated (likely `OOMKilled`) during the resource-intensive synchronization process because the defined memory limits were too low.

### üõ†Ô∏è Resolution: Increasing Content Resource Limits

The fix is to increase the resource requests and limits for the **Hub Content** workers directly in the main **Ansible Automation Platform Custom Resource (CR)**.

#### 1. Update the AAP Custom Resource

Modify the `spec.hub.content.resource_requirements` section of the CR.

[.instruction]
====
Edit the AAP CR to increase the `limits` to accommodate content sync.
====

[source,yaml]
----
# Example snippet of the modified AAP CR
spec:
  hub:
    content:
      resource_requirements:
        limits:
          cpu: 1000m
          memory: 8Gi # Increased memory is key here
        requests:
          cpu: 100m
          memory: 200Mi
----

---

## üõë Problem 2: Insufficient Persistent Volume Claim (PVC) Size

### Diagnosis

Synchronization failed because the PVC for file storage was too small (e.g., `25Mi`), which cannot hold the repository's contents.

### üõ†Ô∏è Resolution: Increasing PVC Storage Size

The fix involves increasing the requested storage size on both the CR and the existing PVC.

#### 1. Update the AAP Custom Resource (Future PVCs)

Update the CR to ensure future PVCs use the correct size.

[source,yaml]
----
# Example snippet of the modified AAP CR
spec:
  automationhub:
    hub_file_storage_size: 10Gi # Increase this value
----

#### 2. Manually Patch the Existing PVC

The storage size of the *existing* PVC must be increased directly (requires a StorageClass that supports volume expansion).

[.instruction]
====
Patch the `aap-rh1-aap-hub-file-storage` PVC to increase its size to `10Gi`.
====

[source,bash]
----
oc edit pvc aap-rh1-aap-hub-file-storage -n aap-rh1 
# Manually change spec.resources.requests.storage to '10Gi'
----

#### 3. Final Verification

Attempt the **"Community"** repository sync again in the UI. A successful sync confirms the resolution.