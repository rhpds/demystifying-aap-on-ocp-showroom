[#scenario-03,cols="3"]
.Scenario #3: Database Service and Gateway Password
|===
| **Mode** | **Components** | **Namespace**

| Easy
| Automation Controller, Gateway
| `aap-rh1`
|===

### üìù Objectives

* Log in to the **AAP Gateway UI** (if possible).
* Observe connectivity failures, likely between the Controller/Web and the database.
* Diagnose two separate issues: one impacting database access and one impacting Gateway login credentials.
* Resolve both issues to restore full functionality.

---

### üí° Hint

* Use `oc get all` and `oc describe` to look for missing or deleted objects that are crucial for service-to-service communication.
* For authentication errors, investigate whether a sensitive resource (like a password or secret) has been changed outside of the standard operator lifecycle.

---

### üõ†Ô∏è Prerequisites: Setup and Break

#### 1. Initial Deployment

[.instruction]
====
Execute the following command, then select **Scenario 3** when prompted.
====

[source,bash]
----
ansible-playbook site.yml -t deploy
----

#### 2. Introduce Failure (Break)

[.instruction]
====
Execute the following command, then select **Scenario 3** when prompted.
====

[source,bash]
----
ansible-playbook site.yml -t break
----

[NOTE]
====
This break introduces a missing database service and a manipulated Gateway password.
====

---

### ‚úÖ Steps to Resolution

#### Step 1: Check Database Connectivity

[.instruction]
====
Check the logs of the Automation Controller and Web pods for database connection errors. Then, check the existence of the expected database service.
====

[source,bash]
----
oc get svc -n aap-rh1
----

[.output]
====
If the database service is missing, you must recreate it using the exact specifications the operator expects, including required metadata like `ownerReferences`.
====

#### Step 2: Check Gateway Access

[.instruction]
====
Attempt to log into the AAP Gateway UI. If authentication fails despite using the correct known credentials, assume the stored password has been corrupted or changed.
====

#### Step 3: Implement the Fixes

[.instruction]
====
1. Recreate the missing database service object.
2. Use the `aap-gateway-manage` utility from within the environment to reset the Gateway password.
====

#### Step 4: Verify Resolution

[.instruction]
====
Verify all pods are running and ready, then successfully log into the AAP UI.
====