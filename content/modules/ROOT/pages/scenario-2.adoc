[#scenario-02,cols="3"]
.Scenario #2: Automation Hub Storage Failure
|===
| **Mode** | **Components** | **Namespace**

| Easy
| Automation Hub
| `aap-rh1`
|===

### üìù Objectives

* Log in to the **AAP Gateway UI** successfully.
* Verify the health of the **Automation Hub** pods.
* Diagnose and resolve the underlying issue preventing the Hub from utilizing persistent storage.

---

### üí° Hint

* The failure is related to how the **Automation Hub** attempts to utilize storage. Review the pod events (`oc describe pod <failing-hub-pod>`) to see if there are errors related to binding a **Persistent Volume Claim (PVC)** or volume access mode.

---

### üõ†Ô∏è Prerequisites: Setup and Break

#### 1. Initial Deployment

Run the main playbook to deploy the required environment components.

[.instruction]
====
Execute the following command, then select **Scenario 2** when prompted.
====

[source,bash]
----
ansible-playbook site.yml -t deploy
----

#### 2. Introduce Failure (Break)

Execute the playbook to introduce the specific error for Scenario #2.

[.instruction]
====
Execute the following command, then select **Scenario 2** when prompted.
====

[source,bash]
----
ansible-playbook site.yml -t break
----

[NOTE]
====
This command sets the Hub's storage class to one that does *not* support the necessary ReadWriteMany access mode, which is required for HA Hub deployments.
====

---

### ‚úÖ Steps to Resolution

#### Step 1: Inspect Pod and PVC Status

[.instruction]
====
Inspect the status of the Automation Hub pods and the Persistent Volume Claims (PVCs) in your namespace.
====

[source,bash]
----
oc get pods -n aap-rh1
oc get pvc -n aap-rh1
----

[.output]
====
Identify any Hub pods in a `Pending` state. Use `oc describe` on the failing pod and the relevant PVC to identify the volume access mode conflict or provisioning error.
====

#### Step 2: Implement the Fix

[.instruction]
====
Modify the main **AAP Custom Resource (CR)** to specify an RWX-compatible `storageClass` (e.g., `ocs-external-storagecluster-cephfs`). Then, manually clear the failed components to force reconciliation.
====

#### Step 3: Verify Resolution

[.instruction]
====
Monitor the namespace until the new PVC is bound and all Hub pods transition to a `Running` and ready state.
====

[source,bash]
----
oc get pods -n aap-rh1
----

[.output]
====
All Hub-related pods should now show:

* **STATUS:** `Running`
* **READY:** `X/X` (e.g., `1/1`)
====