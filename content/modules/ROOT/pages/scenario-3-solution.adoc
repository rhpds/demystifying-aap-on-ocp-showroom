= üí° Scenario #3: Solutions and Resolution

This page provides the detailed solutions for the issues presented in Scenario #3. Review these steps after you have attempted the diagnosis and resolution yourself.

---

## üõë Problem 1: Missing Database Service

### Diagnosis
The core issue was that the Kubernetes **Service** object for the PostgreSQL database (`<scenario-name>-aap-postgres-15`) was missing. Without a service, other components cannot resolve or connect to the database pods.

### üõ†Ô∏è Resolution: Recreating the Database Service

The fix requires recreating the Kubernetes Service object. Crucially, the service must contain specific metadata (like `ownerReferences`) to prevent the Operator from immediately deleting it as an "unmanaged" resource.

#### 1. Define and Apply the Missing Service

Browse to Networking -> Service and create a new service with the following YAML:

[source,yaml]
----
apiVersion: v1
kind: Service
metadata:
  name: "aap-rh1-aap-postgres-15"
  namespace: aap-rh1
  labels:
    app.kubernetes.io/component: database
    app.kubernetes.io/instance: "postgres-15-aap-rh1-aap"
    app.kubernetes.io/managed-by: aap-gateway-operator
    app.kubernetes.io/name: postgres-15
spec:
  clusterIP: None
  ipFamilies:
    - IPv4
  ports:
    - protocol: TCP
      port: 5432
      targetPort: 5432
  internalTrafficPolicy: Cluster
  clusterIPs:
    - None
  type: ClusterIP
  ipFamilyPolicy: SingleStack
  sessionAffinity: None
  selector:
    app.kubernetes.io/component: database
    app.kubernetes.io/instance: "postgres-15-aap-rh1-aap"
    app.kubernetes.io/managed-by: aap-gateway-operator
    app.kubernetes.io/name: postgres-15     
----

[source,bash]
----
oc apply -f postgres-service-fix.yaml -n aap-rh1
----

#### 2. Verification

Wait for the application components (Controller, Web) to automatically re-establish connections now that the database service is available.

[source,bash]
----
oc get pods -n aap-rh1
# All pods should return to a 'Running' and 'Ready' state.
----

---

## üõë Problem 2: Incorrect Gateway Password

### Diagnosis
The second issue was an incorrect password set for the internal **AAP Gateway** administration user (`admin`). This prevents authentication or successful handshakes.

### üõ†Ô∏è Resolution: Resetting the Gateway Password

The solution is to use the dedicated `aap-gateway-manage` utility provided within the environment to reset the password back to the value defined in the Ansible Automation Platform Custom Resource (CR).

#### 1. Execute the Management Command

Run the `aap-gateway-manage update_password` command from the appropriate environment.

[source,bash]
----
aap-gateway-manage update_password --username admin --password $PASSWORD_VALUE_FROM_AAP_SECRET
----

[NOTE]
====
This command sets the `admin` user's password to the value specified in the active AAP Custom Resource (CR).
====

#### 2. Final Verification

Log in to the **AAP UI** to confirm full access.