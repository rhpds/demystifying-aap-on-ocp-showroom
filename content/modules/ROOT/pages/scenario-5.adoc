[#scenario-05,cols="3"]
.Scenario #5: Automation Hub Content Synchronization
|===
| **Mode** | **Components** | **Namespace**

| Easy
| Automation Hub
| `aap-rh1`
|===

### üìù Objectives

* Log in to the **AAP Gateway UI** successfully.
* Navigate to the **Automation Hub** -> **Repositories** section.
* Attempt to synchronize the built-in **"Community"** repository.
* Diagnose and resolve the two underlying issues preventing successful synchronization (resource limits and storage size).

---

### üí° Hint

* Synchronization failures are often related to the worker pods. Use standard Kubernetes tooling (`oc` or `kubectl`) to review the logs for the **Hub Content pods**. Errors may point to **OOMKilled** (resource limits) or **disk quota exceeded** (storage size).

---

### üõ†Ô∏è Prerequisites: Setup and Break

#### 1. Initial Deployment

[.instruction]
====
Execute the following command, then select **Scenario 5** when prompted.
====

[source,bash]
----
ansible-playbook site.yml -t deploy
----

#### 2. Introduce Failure (Break)

[.instruction]
====
Execute the following command, then select **Scenario 5** when prompted.
====

[source,bash]
----
ansible-playbook site.yml -t break
----

[NOTE]
====
This command injects a resource constraint issue (low memory limits) and a storage constraint issue (minimal PVC size) into the Hub's content workers.
====

---

### ‚úÖ Steps to Resolution

#### Step 1: Attempt Repository Sync and Check Pod Logs

[.instruction]
====
Initiate a sync job for the **"Community"** repository. Inspect the logs for the `hub-content` worker pods in your namespace for crash errors or disk-related messages.
====

[source,bash]
----
oc logs -n aap-rh1 <failing-hub-content-pod-name>
----

#### Step 2: Implement Fixes (CR and PVC)

[.instruction]
====
Apply the necessary changes:
1. Increase the resource limits for `hub.content` in the AAP CR.
2. Increase the size of the related PVC (and update the CR for future deployments).
====

#### Step 3: Verify Resolution

[.instruction]
====
After applying the fixes and allowing reconciliation, attempt to sync the **"Community"** repository again.
====

[.output]
====
A successful synchronization job confirms the scenario is complete.
====